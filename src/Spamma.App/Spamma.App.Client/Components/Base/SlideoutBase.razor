@namespace Spamma.App.Client.Components.Base

@* Shared slideout (side panel) component with consistent styling and animations *@

@if (IsVisible)
{
    <div class="fixed inset-0 overflow-hidden z-40" aria-labelledby="@AriaLabelledBy" role="dialog" aria-modal="true">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/30 transition-opacity backdrop-blur-sm"
             @onclick="HandleBackdropClick"
             aria-hidden="true"></div>

        <!-- Slideout Container (prevents pointer events on unused space) -->
        <div class="pointer-events-none fixed inset-y-0 @DirectionClass flex max-w-full @PaddingClass">
            <!-- Actual Panel (pointer-events-auto to capture clicks inside only) -->
            <div class="pointer-events-auto w-screen @WidthClass transform transition ease-in-out duration-300 @(IsVisible ? SlideInClass : SlideOutClass)">
                <div class="flex h-full flex-col overflow-y-auto bg-white shadow-xl">
                    @ChildContent
                </div>
            </div>
        </div>
    </div>
}

@code {
    /// <summary>
    /// Controls slideout visibility.
    /// </summary>
    [Parameter]
    public bool IsVisible { get; set; }

    /// <summary>
    /// Callback when IsVisible should be set to false (user clicks close button, backdrop, or ESC).
    /// </summary>
    [Parameter]
    public EventCallback OnClose { get; set; }

    /// <summary>
    /// Direction the slideout opens from. Options: "left" (default) or "right".
    /// </summary>
    [Parameter]
    public string Direction { get; set; } = "right";

    /// <summary>
    /// Tailwind width class for the slideout. Default is md (w-screen max-w-md).
    /// Options: sm (max-w-sm), md (max-w-md), lg (max-w-lg), xl (max-w-xl), 2xl (max-w-2xl), 3xl (max-w-3xl), 4xl (max-w-4xl), 5xl (max-w-5xl).
    /// </summary>
    [Parameter]
    public string WidthClass { get; set; } = "max-w-md";

    /// <summary>
    /// If true, clicking the backdrop (background) will close the slideout.
    /// Default is true for general-purpose slideouts.
    /// </summary>
    [Parameter]
    public bool AllowBackdropClose { get; set; } = true;

    /// <summary>
    /// ARIA label ID for accessibility. Should reference the slideout header or title element.
    /// </summary>
    [Parameter]
    public string? AriaLabelledBy { get; set; }

    /// <summary>
    /// The slideout content (header, body, footer). Typically includes:
    /// - Header with title and close button
    /// - Body with form/content
    /// - Footer with action buttons
    /// </summary>
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Computed position class based on Direction parameter.
    /// </summary>
    private string DirectionClass => Direction == "left" ? "left-0" : "right-0";

    /// <summary>
    /// Computed padding class to ensure content doesn't go under the slideout.
    /// </summary>
    private string PaddingClass => Direction == "left" ? "pr-10" : "pl-10";

    /// <summary>
    /// CSS class for slide-in animation.
    /// </summary>
    private static string SlideInClass => "translate-x-0";

    /// <summary>
    /// CSS class for slide-out animation (when not visible).
    /// </summary>
    private string SlideOutClass => Direction == "left" ? "-translate-x-full" : "translate-x-full";

    /// <summary>
    /// Handles backdrop click event. Only closes if AllowBackdropClose is true.
    /// </summary>
    private async Task HandleBackdropClick()
    {
        if (AllowBackdropClose)
        {
            await OnClose.InvokeAsync();
        }
    }
}
